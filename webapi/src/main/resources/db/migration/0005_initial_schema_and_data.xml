<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog 
	http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">
	
	<property name="now" value="now()" dbms="mysql,h2"/>
    <property name="now" value="current_timestamp" dbms="postgresql"/>
	
	<changeSet id="0005" author="yama">
		<createTable tableName="salesdetail">
			<column name="id" type="varchar(50)">
				<constraints primaryKey="true" nullable="false" />
			</column>
			<column name="quantity" type="Date" />
			<column name="price" type="BigDecimal" />
			<column name="subtotal" type="BigDecimal" />
		</createTable>
		
		<addForeignKeyConstraint constraintName="fk_sales_id"
			baseTableName="salesdetail"
			baseColumnNames="sales_id"
			referencedTableName="sales" 
			referencedColumnNames="id" />
			
		<addForeignKeyConstraint constraintName="fk_product_id"
			baseTableName="productdetail"
			baseColumnNames="product_id"
			referencedTableName="sales" 
			referencedColumnNames="id" />
			
		<addUniqueConstraint columnNames="sales_id, provider, rank"
			tableName="salesdetail"/>
		
		<addUniqueConstraint columnNames="product_id, provider, provider_user_id"
			tableName="salesdetail/>
		
	</changeSet>
</databaseChangeLog>